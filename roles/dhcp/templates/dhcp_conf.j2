# This file is autogenerated by Ansible {{ ansible_version.full }}
authorative;

default-lease-time         3600;
max-lease-time             7200;

option space PXE;
option PXE.mtftp-ip    code 1 = ip-address;
option PXE.mtftp-cport code 2 = unsigned integer 16;
option PXE.mtftp-sport code 3 = unsigned integer 16;
option PXE.mtftp-tmout code 4 = unsigned integer 8;
option PXE.mtftp-delay code 5 = unsigned integer 8;
option arch code 93 = unsigned integer 16; # RFC4578
option pxe-system-type code 93 = unsigned integer 16; # RFC4578
authorative;

# Define the hosts
{% for entry in dhcp_host_entries %}
host {{ entry.host }}  {
  hardware ethernet {{ entry.hw_addr }};
  fixed-address {{ entry.ip_addr }};
  option host-name "{{ entry.fqdn }}";
}

{% endfor %}


# Define the PXE clients filenames to use for PXE booting
class "pxeclients" {
     match if substring (option vendor-class-identifier, 0, 9) = "PXEClient";
     if option pxe-system-type = 00:02 {
             filename "ia64/elilo.efi";
     } else if option pxe-system-type = 00:06 {
             filename "pxelinux/bootia32.efi";
     } else if option pxe-system-type = 00:07 {
             filename "pxelinux/bootx64.efi";
     } else {
             filename "pxelinux.0";
     }
}

# Define the Subnets section of the page
#

{% for entry in dhcp_subnet_entries %}
subnet {{ entry.subnet }} netmask {{ entry.subnet_mask }} {
     range                      {{ entry.range }};
     option subnet-mask         {{ entry.subnet_mask }};
     option routers             {{ entry.router }};
     option broadcast-address   {{ entry.broadcast }};
     option domain-name-servers {{ entry.dns }};
     option domain-search       "{{ entry.domain_search }}";
     option domain-name         "{{ entry.domain_name }}";

     next-server                {{ entry.next_server }};
}

{% endfor %}

#
# build out the server groups
#

{% for entry in dhcp_group_entries %}
{{ entry.title }}
group {

  {% for host in entry.hosts %}
    {{ host.desc }}
      host {{ host.name }}  {
      hardware ethernet {{ host.hw_addr }};
      fixed-address {{ host.ip_addr }};
      option host-name "{{ host.fqdn }}";
      }

  {% endfor %}
}

{% endfor %}
