---

- name: "Requesting Access Token"
  uri:
    url: "http://10.9.51.153:8080/auth/realms/master/protocol/openid-connect/token"
    method: POST
    body_format: form-urlencoded
    body:
      username: "{{ default_sso_user }}"
      password: "{{ default_sso_pass }}"
      grant_type: "password"
      client_id: "admin-cli"
  register: rh_sso_token

- name: "Create Realm for service Red Hat Single Sign-On"
  uri:
    url: "http://10.9.51.153:8080/auth/admin/realms"
    method: POST
    src: "realm.json"
    remote_src: "no"
    status_code:
     - 201
    headers:
      Content-type: "application/json"
      Accept: "application/json"
      Authorization: "Bearer {{ rh_sso_token.json.access_token }}"
  register: rh_sso_realm_create

