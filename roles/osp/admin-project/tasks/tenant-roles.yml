---

- name: "Obtain the user IDs"
  os_user:
    cloud: "{{ item.cloud | default(osp_default_cloud) | default(omit) }}"
    user: "{{ item.user }}"
    domain: "{{ item.user_domain | default(omit) }}"
  register: list_of_os_users
  with_items:
    - "{{ project.members }}"

- debug:
    msg: "{{ list_of_os_users }}"

- name: "Assign role for project {{ project.name }}"
  os_user_role:
    cloud: "{{ item.cloud | default(osp_default_cloud) | default(omit) }}"
    user: "{{ item.0.user }}"
    role: "{{ item.1 }}"
    project: "{{ project.name }}"
    domain: "{{ item.0.user_domain | default(omit) }}"
  with_subelements:
    - "{{ project.members }}"
    - roles
