---

- name: "Grant access for account {{ role.name }}"
  os_user_role:
    cloud: "{{ item.cloud | default(osp_default_cloud) | default(omit) }}"
    user: "{{ user.name }}"
    role: "{{ role.1 }}"
    project: "{{ role.0.name }}"
    domain: "{{ role.0.domain }}"
  with_subelements:
    - "{{ user.projects }}"
    - roles
  loop_control:
    loop_var: role
