---

- name: "set facts"
  set_fact:
    password: ""
    userid: "{{ item.user_name }}"

- name: "Set password to given value"
  set_fact:
    password: "{{ item.password }}"
  when: item.password is defined

- name: "Create random password"
  set_fact:
    password: "{{ lookup('password','/dev/null length=16') }}"
  when:
  - item.generate_password is defined
  - item.generate_password == True
  - (item.password is not defined or item.password == '')

- name: "newuser passwords"
  set_fact:
    new_passwd: "{{ new_passwd|default({})|combine({item.user_name : password }) }}"


