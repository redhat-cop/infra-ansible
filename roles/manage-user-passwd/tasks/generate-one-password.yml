---

- name: "Set facts"
  set_fact:
    password: ""

- name: "Set password to given value"
  set_fact:
    password: "{{ item.password }}"
  when: item.password is defined

- name: "Create random password"
  set_fact:
    password: "{{ lookup('password','/dev/null length=16') }}"
  when:
  - item.generate_password is defined
  - item.generate_password == True
  - (item.password is not defined or item.password == '')

- name: "Newuser passwords"
  set_fact:
    user_passwords: "{{ user_passwords|default({})|combine({ item.user_name: password }) }}"


