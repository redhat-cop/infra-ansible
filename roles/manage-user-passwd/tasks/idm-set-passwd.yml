---

  - name: "Default password value "
    set_fact:
      password: "{{ user.password }}"
    when: user.password is defined

#
# check if generate isset true and password != ''
#
  - name : Create random password
    set_fact:
      password: "{{ lookup('password','/dev/null length=15' ) }}"
    when: 
    - user.generate is defined
    - user.generate == "True"
    - (user.password == '' or user.password is not defined)


# print password for capture. 
  - name: "Password dump "
    debug:
      msg: "The password about to be set is: {{ password }}"

# call module to update 
  - name: "Change IPA password for user:{{ user.user_name }}"
    ipa_user:
      ipa_host: "{{ ipa_host | default(ansible_host)}}"
      ipa_user: "{{ ipa_admin_user }}"
      ipa_pass: "{{ ipa_admin_password }}"
      validate_certs: "{{ ipa_validate_certs | default(False) }}"
      name: "{{ user.user_name | trim }}"
      password: "{{ password | default('P@55word') }}"
    when: password != ""

