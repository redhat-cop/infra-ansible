---
  - name: "generate a random directory in /tmp"
    delegate_to: localhost
    run_once: true
    tempfile:
      path: /tmp
      state: directory
      prefix: dhcp
    register: dhcp_config_dir

  - name: debug tempfile creation
    run_once: true
    debug: 
      var: dhcp_config_dir
      verbosity: 1

  - name: 'Open permissions on directory'
    delegate_to: localhost
    run_once: true
    file:
      path: '{{ dhcp_config_dir.path }}'
      mode: 0777
      state: directory

  - name: "Generate dhcpd.conf file"
    run_once: true
    template:
      src: subnets.j2
      dest: '{{ dhcp_config_dir.path }}/{{ dhcp_config_temp_file }}'
    delegate_to: localhost
    notify: dhcp-config cleanup temp


  - name: "Move the file to proper location"
    copy:
      src: '{{ dhcp_config_dir.path }}/{{ dhcp_config_temp_file }}'
      dest: '{{ dhcp_config_dest_file }}'
      mode: 0644
      backup: no  # may want to keep a backup 
     # validate: 'dhcpd -t -cf %s'
    notify: dhcp-config cleanup temp

