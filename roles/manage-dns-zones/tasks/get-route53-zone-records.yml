---
- name: Get all hosted zones
  route53_facts:
    aws_access_key: "{{ aws_access_key }}"
    aws_secret_key: "{{ aws_secret_key }}"
    query: hosted_zone
  with_items:
    - "{{ dns_records_rm | default({}) }}"
  register: hosted_zones


- debug:
    msg: "{{ hosted_zones|length }}"

- name: Get all records from zones
  route53_facts:
    aws_access_key: "{{ aws_access_key }}"
    aws_secret_key: "{{ aws_secret_key }}"
    query: record_sets
    hosted_zone_id: "{{ item.Id | replace('/hostedzone/', '')}}"
  with_items:
    - "{{ hosted_zones.results[0].HostedZones | default({}) }}"
  register: zones_records
  when:
    - hosted_zones|length > 0
