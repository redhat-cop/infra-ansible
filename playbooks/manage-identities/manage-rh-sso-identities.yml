---

- name: "Set facts"
  hosts: rh-sso-hosts
  tasks:
    - set_fact:
        rh_sso_host: "192.168.16.3"
        rh_sso_port: 8080
        rh_sso_port_list:
          - 8080/tcp
          - 9990/tcp

- name: "Requesting Access Token"
  hosts: rh-sso-hosts
  tasks:
    - uri:
        url: "http://{{ rh_sso_host }}:{{ rh_sso_port }}/auth/realms/master/protocol/openid-connect/token"
        method: POST
        body_format: form-urlencoded
        body:
          username: "{{ sso_admin_user }}"
          password: "{{ sso_admin_pass }}"
          grant_type: "password"
          client_id: "admin-cli"
      register: rh_sso_token

- name: "Create Realm for service Red Hat Single Sign-On"
  hosts: rh-sso-hosts
  tasks:
    - uri:
        url: "http://{{ rh_sso_host }}:{{ rh_sso_port }}/auth/admin/realms/master/users"
        method: POST
#       body: "{{ realm_json }}"
#       body_format: json
        src: "roles/identity-management/manage-rh-sso-identities/templates/manage-user.json"
        remote_src: "no"
        status_code: 201, 409
        headers:
          Content-type: "application/json"
          Accept: "application/json"
          Authorization: "Bearer {{ rh_sso_token.json.access_token }}"
      register: rh_sso_realm_create

- hosts: rh-sso-hosts
  tasks:
    - debug:
        msg: "{{ rh_sso_realm_create }}"
