---

- hosts: at1-rh-sso

  tasks:
  - name: Install Red Hat Single Sign-On
    yum:
      name: "@rh-sso7"
      state: present

  - name: Update bind addresses
    replace:
      path: /etc/opt/rh/rh-sso7/keycloak/standalone/standalone.xml
      regexp: '127.0.0.1'
      replace: "{{ ansible_facts['default_ipv4']['address'] }}"

  - name: Adding a default keycloak user
    shell: "/opt/rh/rh-sso7/root/usr/share/keycloak/bin/add-user-keycloak.sh --user admin --password test123"
    args:
      executable: "/bin/bash"

  - name: Starting RH SSO in Standalone mode
    service:
      name: rh-sso7
      state: restarted
